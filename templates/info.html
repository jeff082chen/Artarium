<!-- templates/index.html -->
{% extends "base.html" %}
{% block title %}Info{% endblock title %}

{% block navigation %}
    {{ super() }}
{% endblock navigation %}

{% block content %}
    <div class="grid-container">
        {% if info['image'] %}
            <img class="grid-item item1" src="{{ info['image'] }}" alt="image error" width="800">
        {% endif %}
        <br><br>
        <!-- like count -->
        <div class="grid-item item2">
            <div class="like_count">
                <p>likes: {{ info['likeCount'] }}</p>
            </div>
            {% if current_user.is_authenticated %}
            <div class="like_button">
                <a class="nav-link" href="/like?UID={{ info['UID'] }}">like</a>
            </div>
            {% endif %}
        </div>
        <br>
        <div class="grid-item item2">資訊</div>
        <!-- a table for infomation -->
        <table class="grid-item item3">
            <tr>
                <td>名稱</td>
                <td>{{ info['title'] }}</td>
            </tr>
            <tr>
                <td>種類</td>
                <td>{{ info['category'] }}</td>
            </tr>
            {% if info['description'] %}
                <tr>
                    <td>簡介</td>
                    <td>{{ info['description'] }}</td>
                </tr>
            {% endif %}
        </table>
        <br>
        <!--a table for all shows-->
        <table class="grid-item item4">
            <thead>
                <tr>
                    <th>開始時間</th>
                    <th>結束時間</th>
                    <th>地點</th>
                    <th>地址</th>
                    <th>售票情況</th>
                </tr>
            </thead>
            <tbody>
                {% for show in info['shows'] %}
                    <tr>
                        <td>{{ show['start_time'] }}</td>
                        <td>{{ show['end_time'] }}</td>
                        <td>{{ show['location'] }}</td>
                        <td>{{ show['address'] }}</td>
                        <td>{{ show['on_sale'] }}</td>
                        {% if show['longitude'] and show['latitude'] %}
                            <td><a href="/restaurant?UID={{ info['UID'] }}&latitude={{ show['latitude'] }}&longitude={{ show['longitude'] }}">附近餐廳</a></td>
                            <td><a href="/weather?UID={{ info['UID'] }}&latitude={{ show['latitude'] }}&longitude={{ show['longitude'] }}">當地天氣</a></td>
                        {% endif %}
                    </tr>
                {% endfor %}
            </tbody>
        </table>
        <br>
        {% if info['longitude'] and info['latitude'] %}
        <a href="/restaurant?longitude={{ info['longitude'] }}&latitude={{ info['latitude'] }}&UID={{ info['UID'] }}"><button class="grid-item item5">點我前往餐廳</button></a>
        {% endif %}
        <br>
        <!--a table for all comments-->
        {% if info['reply'] %}
        <table class="grid-item item5">
            <thead>
                <tr>
                    <th>No.</th>
                    <th>評論</th>
                    <th>評論者</th>
                </tr>
            </thead>
            <tbody>
                {% for reply in info['reply'] %}
                    <tr>
                        <td>{{ reply['id'] }}</td>
                        <td>{{ reply['content'] }}</td>
                        <td>{{ reply['member_id'] }}</td>
                        {% if current_user.id == reply['member_id'] %}
                            <td><a href="/delete_comment?UID={{ UID }}&comment_id={{ reply['id'] }}">刪除</a></td>
                        {% endif %}
                    </tr>
                {% endfor %}
            </tbody>
        </table>
        {% endif %}
        <br>
        {% if current_user.is_authenticated %}
        <a href="/team?UID={{ info['UID'] }}">揪團</a>
        <div class="grid-item item5">
            <div style="background-color:lightpink;width: 600px;max-width:100%;height: 200px;overflow: scroll;">
                <div id="messageBox"></div>
                <div class="border">
                    <p>使用者留言</p>
                    <form action="/comment" method="post">
                        <input type="hidden" name="UID" value="{{ info['UID'] }}">
                        <textarea name="content" rows="5" cols="50"></textarea>
                        <div style="color:red;"> {{ errorMsg|safe }} </div>
                        <input type="submit" value="送出">
                    </form>
                </div>
            </div>
        </div>
        {% endif %}
    </div>
{% endblock content %}